<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Drag and Move</title>
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="no">
<meta name="apple-mobile-web-app-status-bar-style"
	content="black-translucent">
<script src="jquery-1.7.1.js"></script>
<style type="text/css">
body {
	margin: 0px;
}

#app {
	height: 768px;
	width: 1024px;
	margin: 0px auto;
	overflow: hidden;
}

#imageContainer {
	position: absolute;
	top: 0px;
	left: 0px;
	width: 1024px;
	height: 768px;
	background: gray;
}

#imageContainer img:nth-child(1) {
	position: absolute;
	top: 180px;
	left: 206px;
	width: 320px;
	height: 240px;
	background: yellow;
}

#imageContainer img:nth-child(2) {
	position: absolute;
	top: 140px;
	left: 270px;
	width: 320px;
	height: 240px;
	background: red;
}

#imageContainer img:nth-child(3) {
	position: absolute;
	top: 256px;
	left: 400px;
	width: 320px;
	height: 240px;
	background: black;
}

</style>
</head>
<body>
	<div id='app'>
		<div id="imageContainer">
			<img src="1.jpeg" /> <img src="2.jpeg" /> <img src="3.jpeg" />
		</div>
	</div>
	<script>
		function createDragAndMoveElement(element){
        
			$(element).on('touchstart',function(e){
				$(element).css('z-index',$('#imageContainer')[0].zIndex++);
				//element.last={'x':e.originalEvent.touches[0].pageX,
				//			  'y':e.originalEvent.touches[0].pageY};
				//element.position=element.position||{'x':0,'y':0};
				return false;
			});
			
			$(element).on('touchmove',function(e){
				if(!element.gesturestart){
					//console.log('touch move');
					//element.position.x=element.position.x+e.originalEvent.touches[0].pageX-element.last.x;
					//element.position.y=element.position.y+e.originalEvent.touches[0].pageY-element.last.y;
					//$(element).css('-webkit-transform','translate('+element.position.x+'px,'+element.position.y+'px)');
					
					//element.last={'x':e.originalEvent.touches[0].pageX,
					//		  'y':e.originalEvent.touches[0].pageY};
				}
				else{
					console.log(e.originalEvent.changedTouches.length+' touch move');
					console.log('all touch: '+e.originalEvent.touches.length);
					
                    var firstTouch = e.originalEvent.touches[0];
                    var secondTouch = e.originalEvent.touches[1];
                    var position = $(element).position();
                    if(!element.center){
                        element.center = {
                            'x':(firstTouch.clientX + secondTouch.clientX)*0.5,
                            'y':(firstTouch.clientY + secondTouch.clientY)*0.5
                        };
                        //console.log('position:'+position.left +' '+position.top);
                    }
                    else{
                        element.translate = {
                            'x':(firstTouch.clientX + secondTouch.clientX)*0.5-element.center.x,
                            'y':(firstTouch.clientY + secondTouch.clientY)*0.5-element.center.y
                        };
                    }
                    //console.log((element.center.x-parseInt($(element).css('left'))) + 'px' + ' ' + (element.center.y-parseInt($(element).css('top'))) + 'px');
                    var deltaX = element.translate ? element.translate.x+'px' : 0;
                    var deltaY = element.translate ? element.translate.y+'px' : 0;
                    var left = parseInt($(element).css('left'));
                    var top = parseInt($(element).css('top'));
                    $(element).css({
                        '-webkit-transform-origin':(element.center.x-left) + 'px' + ' ' + (element.center.y-top) + 'px',
                        '-webkit-transform':'perspective(1200px) translate3d('+deltaX+','+deltaY+',0) rotateZ('+element.rotation+'deg) rotateX(15deg) rotateY(0deg) scale('+element.scale+')'
                    });
				}
			});
			
			$(element).on('touchend',function(e){
				//console.log('>>end');
                //$(element).addClass('fullScreen');
			});
        
        
        	$(element).on('gesturestart gesturechange gestureend',function(e){
				if(e.type=='gesturestart'){
					//console.log('gesture start.');
					element.gesturestart=true;
					$(element).css({
						'-webkit-box-shadow':'30px 30px 20px rgba(0, 0, 0, 0.4)'
					});
				}
				if(e.type=='gesturechange'){
					//console.log('gesture change.');
					element.scale = 1+(e.originalEvent.scale-1)*0.5;
					element.rotation = e.originalEvent.rotation;
				}
				if(e.type=='gestureend'){
					//console.log('gesture end.');
					element.gesturestart=false;
					element.scale='';
					element.rotation='';
					element.center='';
					$(element).css({
						'-webkit-box-shadow':'30px 30px 20px rgba(0, 0, 0, 0)',
						'-webkit-transform':'translate3d(0,0,0) scale(1) rotate(0)',
						'-webkit-transition-duration':'0.5s'
					});
				}
			});
        	
        	$(element).on('webkitTransitionEnd',function(e){
        		$(element).css({
					'-webkit-transition-duration':'0'
				});
        	});
		}
		
		var elements=$('#imageContainer').children('img');
		$.each(elements,function(){
			createDragAndMoveElement(this);
		});
		$('#imageContainer')[0].zIndex=1;
	</script>
</body>
</html>